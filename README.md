# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка 

```
interface ICard {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```

Пользователь

```
interface IUser {
    address: string;
    phone: string;
    email: string;
    payment: string;
}
```

Расширение для модели пользователей

```
interface IUserForm extends IUser{
    total: number;
    items: string[];
    setAddress(field: string, value: string): void
    validateAddress(): boolean;
    setOrderData(field: string, value: string): void
    validateContacts(): boolean;
    getOrder(): object;
}
```

Интерфейс для модели данных карточек

```
interface ICardsData {
    cards: ICard[];
    preview: ICard;
    setPreview(item: ICard): void;
}
```

Интерфейс для модели данных корзины

```
interface IBasketModel {
    items: ICard[];
    getQuantity(): number;
    remove(id: string): void;
    clearBasket(): void;
    getBasketPrice(): number;
    setSelectedCard(data: ICard): void;
}
```

Интерфейс ответа о заказе

```
interface IOrderResponse {
    id: string;
    total: number;
}
```

Тип для интерфейса ошибок

```
type FormErrors = Partial<Record<keyof IUserForm, string>>;
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
handleResponse
 - `handleResponse` - принимает ответ от сервера как параметр, и обрабатывает его,возвращая результат в формате 'json' или отклоненный промис с возникшей ошибкой.
- `_request` - выполняет запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `off` - для отписки от события.
- `emit` - уведомления подписчиков о наступлении события соответственно.
- `onAll` - для подписки на все события.
- `offAll` - сброса всех подписчиков.
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и отображение товаров.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `_cards: ICard[]` - массив объектов карточек
- `_preview: ICard` - карточка, выбранная для просмотра в модальном окне
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс представляет набор методов для взаимодействия с этими данными.
- setPreview(item: ICard): void - метод, вызывающий событие открытия модального окна с выбранной карточкой.

#### Класс BasketModel
Класс отвечает за хранение и логику работы с товарами в корзине.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- items: ICard[] - Массив товаров добавленных в корзину.
- total: number - стоимость товаров в корзине.
- itemsList: string[] - массив строк товаров, добавленных в корзину.

Так же класс представляет набор методов для взаимодействия с этими данными.
- getQuantity(): number - Получить количество позиций в корзине.
- remove(id: string): void - удалить товар из корзины.
- clearBasket(): void - очистить корзину.
- getBasketPrice(): number - отобразить стоимость текущих товаров в корзине.
- setSelectedCard(data: ICard): void - добавление выбранного товара в корзину.
- removeDublicate():void - удалить дубликаты в массиве.
- getOrderInfo(): void - возвращает товары из корзины и их стоимость.

#### Класс UserForm 
Класс отвечает за хранение и логику работы с данными пользователя.\
Класс отвечает за валидацию данных.\
Расширяет класс IUser.\
В полях класса храняться следующие данные:
- address: string - адресс пользователя
- tel: string - номер телефона
- mail: string - почта
- payMethod: string - метод оплаты

Так же класс представляет набор методов для взаимодействия с этими данными.
- setAddress(field: string, value: string): void - получение адреса из поля
- validateAddress(): boolean - валидация поля "адрес"
- setOrderData(field: string, value: string): void - получение адреса электронной почты и телефона из полей
- validateContacts(): boolean - валидация полей с номером телефона и электронной почтной
- getOrder(): object - получить данные о контактной информации в заказе

### Классы представлений
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваймых в них данных.

#### Класс Popup
Реализует модальное окно. Предоставляет методы для управления состоянием окна.

`constructor(container: HTMLElement, protected events: IEvents)`
 - принимает DOM-элемент модального окна на базе шаблона и брокер событий

Поля:

- container - элемент модального окна
- _button - элемент кнопки закрытия модального окна
- _content - элемент с содержимым модального окна
- _wrapper - элемент обертки страницы

Сеттеры:

- content - меняет содержимое модального окна
- locked - блокирует и разблокирует прокрутку страницы

Методы:

- open() - открывает модальное окно
- close() - закрывает и стирает содержимое модального окна
- render() - рендерит модальное окно с переданным содержимым и открывает его

#### Класс Basket
Класс отвечает за реализацию корзины. Представляет сеттеры и метеды для работы с корзиной.

Поля: 
- basket - элемент корзины
- title - элемент названия товара
- basketList - элемент списка товаров
- button - элемент кнопки оформления заказа
- price - элемент цены товара
- basketButton - элемент кнопки открытия корзины
- basketCounter - элемент-счетчик количества товаров

Сетторы:
- items - управление статусом кнопки заказа в зависимости от наличия товаров в корзине

Методы:

- renderQuantity(value: number) - отображение количества товаров в корзине
- renderSum(sum: number) - отображение стоимости заказа в корзине
- render() - отображение корзины

#### Класс Card
Класс для отображения карточки товара на главной странице или в модальном окне корзины.

Поля:
- _card - элемент карточки с товаром
- _image - элемент изображения товара
- _title - элемент названия товара
- _category - элемент категории товара
- _price - элемент стоимости товара
- _colors = <Record<string, string> - массив, отвечающие за цветовое соответсвие с категорией

Сеттеры:
- category(value: string) - отображение соответсвующего цвета в зависимости от категории

Методы: 
- setText - устанавливает текст у элемента в зависимости от переданного значения
- setPrice - метод для получения стоисмости и заполнение полученным значением
- render() - метод отображения карточки товара

`setText(element: HTMLElement, value: unknown): string` - 

#### Класс ContactsForm
Класс отвечающий за форму с контактными данными.

`constructor(template: HTMLTemplateElement, protected events: IEvents)` - принимает тимплейт с формой и брокер событий

Поля:
- contactsForm - элементы формы с полями контактных данных
- inputAll - поля всех форм
- button - элемент кнопки формы
- error - элемент ошибки валидации

Сеттеры:
- valid(value: boolean) - отвечает за отклуючение кнопки

Методы: 

- render() - метод для отображения формы с контактными данными

#### Класс Order

Класс отвечает за форму с выбором способа оплаты и адресом доставки

Поля:

- orderForm - элемент формы с адресом доставки
- payMethod - элемент с выбором способа оплата
- errors - элемент с ошибками валидации поля с адресом
- buttons - элемент с кнопками формы адреса

Сеттеры:

- payMethod(payMethod: string) - сеттер для разблокировки кнопки с соответсвующим методом оплаты
- valid(value: boolean) - сеттер для валидации адреса доставки

Методы: 

- render() - метод для отображения формы с адресом и методом оплаты

#### OrderStatus

Класс для отображения статуса заказа. 

Поля:

- status - элемент модального окна со статусом заказа
- descriprion - элемент со стоимостью заказа
- button - элемент кнопки закрытия модального окна

Метод:

render(value: number) - метод, отвечающий за подсчет общей стоимости товаров

#### Preview 
Класс, являющийся продолжением класс Card.\
Отвечает за отображение карточки товара в превью. Позволяет добавлять карточку в корзину

Поля: 

- text - элемент описания товара
- button - элемент кнопки добавления товара

Метод: 

render(data: ICard) - метод отображения карточки товара в превью

#### Items
Класс для отображения списка товаров в корзине.

Поля:

- item - элемент товара
- index - элемент номера товара
- title - элемент названия товара
- price - элемент стоимости товара
- deleteButton - элемент кнопки удаления товара

Методы: 

- setPrice - метод для установки стоимости товара, получемых при передаче данных. Преобразует числа в строку.
- render(data: ICard, item: number) - метод, для отображения товаров в корзине

#### Page
Класс для отображения коллекции карточек на главной странице.

Методы:
- catalog(item: HTMLElement): void - вставляет заданную карточку на страницу.

### Взаимодействие компонентов (Presenter)

Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в index.ts\
В index.ts сначала создаются экземпляры событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts